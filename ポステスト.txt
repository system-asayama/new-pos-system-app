# herokuバックアップ
heroku pg:backups:capture -a new-pos-system-test


# herokuバックアップダウンロード
heroku pg:backups:download -a new-pos-system-test


# herokuログイン
heroku login


# herokuログイン状態の確認
heroku auth:whoami


# herokuログアウト
heroku logout


# 再起動
heroku ps:restart -a new-pos-system-test
heroku logs --tail -a new-pos-system-test


# ログ確認
heroku logs --tail -a new-pos-system-test


# ログテキスト抽出
heroku logs -n 200 -a new-pos-system-test-app | Out-File -FilePath "logs_after_fix.txt" -Encoding UTF8


# アプリ名確認
heroku apps


# 正しいテスト環境へデプロイするスクリプト
$env:APP = "new-pos-system-test"

heroku git:remote -a $env:APP -r deploy
git add -A
git commit -m "deploy: latest changes"
git push deploy HEAD:main -f        # ← heroku ではなく deploy リモート
heroku ps:restart -a $env:APP
heroku logs --tail -a $env:APP --dyno web.1 --source app



# DB接続
heroku pg:psql -a $env:APP



# DB確認
heroku pg:psql -c "\dt"



# 全テーブルの中身を確認
SELECT
  table_name AS テーブル名,
  column_name AS カラム名,
  data_type AS データ型,
  character_maximum_length AS 文字長,
  numeric_precision AS 精度,
  numeric_scale AS スケール,
  is_nullable AS NULL許可,
  column_default AS デフォルト値
FROM information_schema.columns
WHERE table_schema = 'public'
ORDER BY table_name, ordinal_position;



# 全テーブルの中身をCSV出力
\pset format unaligned
\pset tuples_only
\o export_all_tables.sql
SELECT '\copy "' || tablename || '" TO ''' || tablename || '.csv'' CSV HEADER;'
FROM pg_tables
WHERE schemaname = 'public';
\o
export_all_tables.sql




# データ削除
BEGIN;
DELETE FROM "T_明細進捗";
DELETE FROM "T_注文明細";
DELETE FROM "T_注文";
DELETE FROM "T_お客様詳細";
-- 確認してOKなら
COMMIT;
-- 問題があれば
-- ROLLBACK;





