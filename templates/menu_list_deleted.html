{% extends "base.html" %}
{% block title %}削除済みメニュー一覧{% endblock %}
{% block content %}

<h2>削除済みメニュー一覧</h2>

<div style="margin:8px 0 16px">
  <a class="btn sub" href="{{ url_for('admin_menu_list') }}">← メニュー一覧へ戻る</a>
</div>

<style>
.table{ width:100%; border-collapse:collapse }
.table th,.table td{ border-bottom:1px solid var(--border); padding:8px; text-align:left }
.text-right{ text-align:right }
.badge{display:inline-block;padding:2px 8px;border-radius:9999px;font-size:12px}
.badge.danger{background:#ef4444;color:#fff}
.badge.muted{background:#e5e7eb;color:#374151}
.actions form{display:inline}
.actions .btn{margin-right:6px}
.small{font-size:12px;color:var(--muted)}
</style>

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div style="margin-bottom:.75rem;">
      {% for category, msg in messages %}
        <div class="alert {{ category }}">{{ msg }}</div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}

{% if menus|length == 0 %}
  <div class="card small">削除済みメニューはありません。</div>
{% else %}
  <table class="table">
    <thead>
      <tr>
        <th style="width:80px">ID</th>
        <th>名称</th>
        <th style="width:120px">価格(税抜)</th>
        <th style="width:120px">価格(税込)</th>
        <th style="width:120px">状態</th>
        <th style="width:240px">削除日時</th>
        <th style="width:260px">操作</th>
      </tr>
    </thead>
    <tbody>
      {% for m in menus %}
      <tr>
        <td>{{ m.id }}</td>
        <td>{{ m.name }}</td>
        <td class="text-right">¥{{ m.price }}</td>
        <td class="text-right">¥{{ m.price_incl }}</td>
        <td><span class="badge danger">削除済</span></td>
        <td>{{ m.deleted_at or '-' }}</td>
        <td class="actions">
          <!-- 復活（論理削除解除） -->
          <form method="post" action="{{ url_for('admin_menu_restore', mid=m.id) }}">
            <button class="btn" type="submit">復活</button>
          </form>
          <!-- 復活＋提供開始（任意。不要なら削除） -->
          <form method="post" action="{{ url_for('admin_menu_restore_and_enable', mid=m.id) }}">
            <button class="btn sub" type="submit">復活して提供開始</button>
          </form>
          <!-- 物理削除（本当に不要なら削除推奨）。外部キーがあると失敗します -->
          {# <form method="post" action="{{ url_for('admin_menu_hard_delete', mid=m.id) }}"
                onsubmit="return confirm('完全に削除します。元に戻せません。よろしいですか？');">
            <button class="btn danger" type="submit">完全削除</button>
          </form> #}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
{% endif %}

{% endblock %}
