{% extends "base.html" %}
{% block content %}
<h2>支払方法マスタ</h2>

<div class="grid" style="grid-template-columns:320px 1fr; gap:16px">
  <!-- 左：新規登録フォーム -->
  <div class="card">
    <h3>新規登録</h3>
    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <ul class="flash" style="margin:0 0 10px 0; padding-left:18px; color:#b91c1c">
          {% for m in messages %}<li>{{ m }}</li>{% endfor %}
        </ul>
      {% endif %}
    {% endwith %}

    <form method="post" action="{{ url_for('admin_payment_methods_new') }}">
      <label>コード <span class="small" style="color:var(--muted)">（例: CASH / CARD / QR / IC）</span></label>
      <input name="コード" required placeholder="例: CASH">

      <label>名称</label>
      <input name="名称" required placeholder="例: 現金">

      <label>表示順</label>
      <input name="表示順" type="number" inputmode="numeric" value="0">

      <div style="margin-top:12px">
        <button class="btn" type="submit">登録</button>
      </div>
      <p class="small" style="margin-top:8px;color:var(--muted)">
        ・コードは一意です。重複すると登録できません。<br>
        ・「表示順」は小さいほど上に表示されます。
      </p>
    </form>
  </div>

  <!-- 右：一覧 -->
  <div class="card">
    <h3>一覧</h3>
    <table>
      <thead>
        <tr>
          <th style="width:56px">#</th>
          <th style="width:140px">コード</th>
          <th>名称</th>
          <th style="width:96px">表示順</th>
          <th style="width:96px">有効</th>
          <th style="width:180px">操作</th>
        </tr>
      </thead>
      <tbody>
        {% for r in rows %}
        <tr>
          <td>{{ r['id'] }}</td>
          <td><code>{{ r['コード'] }}</code></td>
          <td>{{ r['名称'] }}</td>
          <td>{{ r['表示順'] }}</td>
          <td>
            {% if r['有効'] == 1 %}
              <span class="badge">◯</span>
            {% else %}
              <span class="badge" style="background:#e5e7eb;color:#374151">×</span>
            {% endif %}
          </td>
          <td>
            <form method="post"
                  action="{{ url_for('admin_payment_methods_toggle', pid=r['id']) }}"
                  style="display:inline">
              <button class="btn sub" type="submit">
                {{ '無効化' if r['有効']==1 else '有効化' }}
              </button>
            </form>
            <!-- ここに将来的な編集/削除ボタンを追加可能（ルート実装後） -->
          </td>
        </tr>
        {% endfor %}
        {% if not rows %}
        <tr>
          <td colspan="6" class="small">未登録です。左のフォームから追加してください。</td>
        </tr>
        {% endif %}
      </tbody>
    </table>

    <div class="small" style="margin-top:12px;color:var(--muted)">
      ※ 会計時の支払方法選択は <code>/admin/payment_methods/json</code> の結果（有効=1 のみ）を使います。
    </div>
  </div>
</div>

<!-- 画面下：戻る -->
<div style="margin-top:16px">
  <a class="btn sub" href="{{ url_for('floor') }}">フロアへ戻る</a>
</div>
{% endblock %}
