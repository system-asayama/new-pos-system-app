{% extends "base.html" %}

{% block content %}
<div style="margin-bottom:16px;">
  <a href="{{ url_for('admin_product_options') }}" class="btn sub">← 一覧に戻る</a>
</div>

<!-- オプション基本情報 -->
<div class="card">
  <h2>オプション基本情報</h2>
  
  <form method="post">
    <input type="hidden" name="action" value="update_option">
    
    <label>オプション名 <span style="color:var(--danger);">*</span></label>
    <input type="text" name="option_name" value="{{ option.option_name }}" required>

    <label>適用商品</label>
    <select name="product_id">
      <option value="" {% if not option.product_id %}selected{% endif %}>全商品共通</option>
      {% for product in products %}
      <option value="{{ product.id }}" {% if option.product_id == product.id %}selected{% endif %}>
        {{ product.name }}
      </option>
      {% endfor %}
    </select>

    <label>表示順</label>
    <input type="number" name="display_order" value="{{ option.display_order }}" min="0">

    <label>
      <input type="checkbox" name="required" value="1" {% if option.required %}checked{% endif %} style="width:auto; margin-right:8px;">
      必須選択にする
    </label>

    <label>
      <input type="checkbox" name="multiple" value="1" {% if option.multiple %}checked{% endif %} style="width:auto; margin-right:8px;">
      複数選択を許可する
    </label>

    <label>
      <input type="checkbox" name="active" value="1" {% if option.active %}checked{% endif %} style="width:auto; margin-right:8px;">
      有効にする
    </label>

    <div style="margin-top:24px;">
      <button type="submit" class="btn">更新</button>
    </div>
  </form>
</div>

<!-- 選択肢管理 -->
<div class="card" style="margin-top:16px;">
  <h2>選択肢管理</h2>
  
  {% if choices %}
  <table style="margin-bottom:24px;">
    <thead>
      <tr>
        <th>選択肢名</th>
        <th>追加料金</th>
        <th>表示順</th>
        <th>状態</th>
        <th>操作</th>
      </tr>
    </thead>
    <tbody>
      {% for choice in choices %}
      <tr>
        <td>
          <form method="post" style="display:inline;" id="form-choice-{{ choice.id }}">
            <input type="hidden" name="action" value="update_choice">
            <input type="hidden" name="choice_id" value="{{ choice.id }}">
            <input type="text" name="choice_name" value="{{ choice.choice_name }}" style="width:auto; min-width:150px;">
          </form>
        </td>
        <td>
          <input type="number" name="extra_price" value="{{ choice.extra_price }}" form="form-choice-{{ choice.id }}" style="width:100px;">円
        </td>
        <td>
          <input type="number" name="choice_display_order" value="{{ choice.display_order }}" form="form-choice-{{ choice.id }}" style="width:80px;">
        </td>
        <td>
          <select name="choice_active" form="form-choice-{{ choice.id }}" style="width:auto;">
            <option value="1" {% if choice.active %}selected{% endif %}>有効</option>
            <option value="0" {% if not choice.active %}selected{% endif %}>無効</option>
          </select>
        </td>
        <td>
          <div class="actions">
            <button type="submit" form="form-choice-{{ choice.id }}" class="btn sub" style="padding:6px 10px; font-size:12px;">保存</button>
            <form method="post" style="display:inline;" onsubmit="return confirm('本当に削除しますか？');">
              <input type="hidden" name="action" value="delete_choice">
              <input type="hidden" name="choice_id" value="{{ choice.id }}">
              <button type="submit" class="btn sub" style="padding:6px 10px; font-size:12px; background:#fee2e2; border-color:#fecaca; color:#991b1b;">削除</button>
            </form>
          </div>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <p style="color:var(--muted); text-align:center; padding:20px 0;">選択肢が登録されていません。</p>
  {% endif %}

  <!-- 新規選択肢追加フォーム -->
  <div style="border-top:1px solid var(--border); padding-top:16px;">
    <h3 style="font-size:16px; margin:0 0 12px;">新しい選択肢を追加</h3>
    <form method="post">
      <input type="hidden" name="action" value="add_choice">
      
      <div style="display:grid; grid-template-columns:2fr 1fr 1fr auto; gap:12px; align-items:end;">
        <div>
          <label>選択肢名 <span style="color:var(--danger);">*</span></label>
          <input type="text" name="choice_name" placeholder="例: 水割り、お湯割り" required>
        </div>
        <div>
          <label>追加料金（円）</label>
          <input type="number" name="extra_price" value="0" min="0">
        </div>
        <div>
          <label>表示順</label>
          <input type="number" name="choice_display_order" value="0" min="0">
        </div>
        <div>
          <button type="submit" class="btn" style="margin-bottom:0;">追加</button>
        </div>
      </div>
    </form>
  </div>
</div>

<!-- 使用例 -->
<div class="card" style="margin-top:16px;">
  <h3 style="font-size:16px; margin:0 0 12px;">💡 使用例</h3>
  <p style="font-size:14px; color:var(--muted); line-height:1.6;">
    このオプションは、メニュー画面で以下のように表示されます：
  </p>
  <div style="background:var(--sub); border:1px solid var(--border); border-radius:8px; padding:16px; margin-top:12px;">
    <p style="margin:0 0 8px; font-weight:bold;">{{ option.option_name }}{% if option.required %} <span style="color:var(--danger);">*</span>{% endif %}</p>
    {% if choices %}
    {% for choice in choices %}
    {% if choice.active %}
    <label style="display:block; padding:8px; background:#fff; border:1px solid var(--border); border-radius:6px; margin-bottom:6px; cursor:pointer;">
      <input type="{% if option.multiple %}checkbox{% else %}radio{% endif %}" name="demo" style="width:auto; margin-right:8px;">
      {{ choice.choice_name }}
      {% if choice.extra_price > 0 %}
      <span style="color:var(--muted); font-size:12px;">(+{{ choice.extra_price }}円)</span>
      {% endif %}
    </label>
    {% endif %}
    {% endfor %}
    {% else %}
    <p style="color:var(--muted); font-size:12px; margin:0;">選択肢を追加してください</p>
    {% endif %}
  </div>
</div>
{% endblock %}

