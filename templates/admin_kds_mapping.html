{% extends "base.html" %}
{% block content %}
<h2>KDSカテゴリ割当</h2>

<!-- 戻るボタン -->
<div style="margin:8px 0 16px;">
  {% if has_endpoint('admin_kds_home') %}
    <a class="btn" href="{{ url_for('admin_kds_home') }}">← 戻る</a>
  {% else %}
    <a class="btn" href="javascript:history.back()">← 戻る</a>
  {% endif %}
</div>

<div class="grid" style="grid-template-columns: 360px 1fr;">
  <!-- 左: 新規割当フォーム -->
  <div class="card">
    <h3>新規割当</h3>
    <p class="small" style="color:var(--muted); margin-bottom:12px;">
      メニューをどのKDSカテゴリに表示するかを割り当てます。
    </p>
    <form method="post" action="{{ url_for('admin_kds_mapping') }}">
      <input type="hidden" name="act" value="create">

      <label>メニュー（必須）</label>
      <select name="menu_id" required>
        <option value="" disabled selected>-- メニューを選択 --</option>
        {% for m in menus %}
          <option value="{{ m.id }}">{{ m.name }}</option>
        {% endfor %}
      </select>

      <label>KDSカテゴリ（必須）</label>
      <select name="kds_category_id" required>
        <option value="" disabled selected>-- KDSカテゴリを選択 --</option>
        {% for c in kds_categories %}
          <option value="{{ c.id }}">{{ c.名称 }}</option>
        {% endfor %}
      </select>

      <div style="margin-top:12px;">
        <button class="btn" type="submit">＋ 割り当てを追加</button>
      </div>
    </form>
  </div>

  <!-- 右: 割当済み一覧＋未割当一覧 -->
  <div class="card">
    <h3>割当済み一覧</h3>
    <div style="overflow:auto; margin-bottom:24px;">
      <table>
        <thead>
          <tr>
            <th>メニュー名</th>
            <th>KDSカテゴリ名</th>
            <th style="width:100px;">操作</th>
          </tr>
        </thead>
        <tbody>
          {% for item in mappings %}
          <tr>
            <td>{{ item.menu_name }}</td>
            <td>{{ item.kds_category_name }}</td>
            <td>
              <form method="post"
                    action="{{ url_for('admin_kds_mapping') }}"
                    onsubmit="return confirm('この割当を削除しますか？');">
                <input type="hidden" name="act" value="delete">
                <input type="hidden" name="mapping_id" value="{{ item.id }}">
                <button class="btn sub" type="submit">削除</button>
              </form>
            </td>
          </tr>
          {% else %}
          <tr>
            <td colspan="3" class="muted">まだ割り当てはありません。</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- ★ 未割当メニュー一覧 -->
    <h3 style="margin-top:8px;">未割当メニュー一覧</h3>
    <p class="small" style="color:var(--muted);">
      まだどのKDSカテゴリにも割り当てられていないメニューです。
    </p>
    <div style="overflow:auto;">
      <table>
        <thead>
          <tr>
            <th>メニュー名</th>
          </tr>
        </thead>
        <tbody>
          {% for m in unassigned_menus %}
          <tr>
            <td>{{ m.name }}</td>
          </tr>
          {% else %}
          <tr>
            <td class="muted">未割当のメニューはありません。</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
